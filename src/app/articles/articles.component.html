
<app-reusable-header
  [titleKey]="'articlesTitle'"
  [translucent]="true"
  [showMenuButton]="true">
</app-reusable-header>

<ion-content>

  <div class="add-blog-section" *appShowForRoles="['admin']">
    <ion-button (click)="openAddBlogForm()" fill="solid" expand="block" class="add-blog-btn">
      <ion-icon name="add" slot="start"></ion-icon>
      Add New Blog
    </ion-button>
  </div>


  <app-segmented-tabs
    [tabs]="contentCategories"
    [selectedTab]="selectedTopic"
    containerClass="krishna-tabs-container"
    (tabChanged)="onTabChanged($event)">
  </app-segmented-tabs>

  <ion-content class="articles-content">
    <div class="articles-container">
      <!-- Loading State for All Categories -->
      @if (isLoading) {
        <app-skeleton-loader 
          [config]="{
            type: 'cards',
            itemCount: 6,
            showCategoryTitle: true,
            cardLayout: 'grid'
          }">
        </app-skeleton-loader>
      }

      <!-- Content (shown when not loading) -->
      @if (!isLoading) {
        <div>
          <!-- Show blogs for current category -->
          @if (hasCurrentCategoryBlogs) {
            <div class="category-content">
              <div class="blogs-grid">
                @for (blog of filteredBlogs; track blog) {
                  <div class="blog-card"
                    (click)="onCardClick(blog._id!)">
                    <div class="card-actions" *appShowForRoles="['admin']">
                      <ion-button
                        fill="clear"
                        size="small"
                        (click)="editBlog(blog._id!, $event)"
                        class="edit-btn">
                        <ion-icon name="create-outline"></ion-icon>
                      </ion-button>
                      <ion-button
                        fill="clear"
                        size="small"
                        (click)="confirmDeleteBlog(blog._id!, $event)"
                        class="delete-btn">
                        <ion-icon name="trash-outline"></ion-icon>
                      </ion-button>
                    </div>
                    <img [src]="blog.blogImgUrl" [alt]="blog.blogTitle">
                    <div class="card-content">
                      <h3>{{ blog.blogTitle }}</h3>
                      <p class="author">By {{ blog.author }}</p>
                      <p class="category-badge">{{ blog.category | titlecase }}</p>
                      @if (blog.comments && blog.comments.length > 0) {
                        <div class="comments-count">
                          <ion-icon name="chatbubble-outline"></ion-icon>
                          <span>{{ blog.comments.length }} comment{{ blog.comments.length !== 1 ? 's' : '' }}</span>
                        </div>
                      }
                    </div>
                  </div>
                }
              </div>
            </div>
          }
          <!-- Show "No articles found" message when no blogs in current category -->
          @if (!hasCurrentCategoryBlogs) {
            <div class="no-articles-content">
              <div class="no-articles-card">
                <ion-icon name="language-outline" class="no-articles-icon"></ion-icon>
                <h2>No Articles Found</h2>
                <p>There are no articles in the "{{ selectedTopic | titlecase }}" category yet.</p>
                <p class="subtitle" *appShowForRoles="['admin']">Click "Add New Blog" to create the first article in this category!</p>
                @if (!(canShowAdminFeatures$ | async)) {
                  <p class="subtitle">Please check back soon for new content!</p>
                }
              </div>
            </div>
          }
        </div>
      }
    </div>
  </ion-content>

  <!-- Blog Form Modal -->
  <app-blog-form
    [isOpen]="isFormOpen"
    [editingBlog]="editingBlog"
    (modalClosed)="closeBlogForm()"
    (blogSaved)="onBlogSaved($event)">
  </app-blog-form>

  <!-- Action Sheet for Blog Actions -->
  <ion-action-sheet
    [isOpen]="isActionSheetOpen"
    header="Blog Actions"
    (didDismiss)="closeActionSheet()"
    [buttons]="actionSheetButtons">
  </ion-action-sheet>