
<app-reusable-header 
  [titleKey]="'articlesTitle'" 
  [translucent]="true" 
  [showMenuButton]="true">
</app-reusable-header>

<ion-content>

  <div class="add-blog-section" *appShowForRoles="['admin']">
    <ion-button (click)="openAddBlogForm()" fill="solid" expand="block" class="add-blog-btn">
      <ion-icon name="add" slot="start"></ion-icon>
      Add New Blog
    </ion-button>
  </div>


<app-segmented-tabs
  [tabs]="contentCategories"
  [selectedTab]="selectedTopic"
  containerClass="krishna-tabs-container"
  (tabChanged)="onTabChanged($event)">
</app-segmented-tabs>

<ion-content class="articles-content">
  <div class="articles-container">
    <!-- Loading State for All Categories -->
    <div *ngIf="isLoading" class="skeleton-container">
      <!-- Category Title Skeleton -->
      <div class="skeleton-category">
        <ion-skeleton-text animated style="width: 60%; height: 24px; margin-bottom: 16px; display: block !important; visibility: visible !important;"></ion-skeleton-text>
      </div>
      
      <!-- Card Skeletons -->
      <div class="skeleton-cards">
        <div class="skeleton-card" *ngFor="let item of [1,2,3,4,5,6]">
          <div class="skeleton-card-content">
            <ion-skeleton-text animated style="width: 100%; height: 160px; border-radius: 12px; display: block !important; visibility: visible !important;"></ion-skeleton-text>
            <div class="skeleton-card-info">
              <ion-skeleton-text animated style="width: 80%; height: 18px; margin-top: 12px; display: block !important; visibility: visible !important;"></ion-skeleton-text>
              <ion-skeleton-text animated style="width: 60%; height: 14px; margin-top: 8px; display: block !important; visibility: visible !important;"></ion-skeleton-text>
              <ion-skeleton-text animated style="width: 40%; height: 14px; margin-top: 8px; display: block !important; visibility: visible !important;"></ion-skeleton-text>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Content (shown when not loading) -->
    <div *ngIf="!isLoading">
      <!-- Show blogs for current category -->
      <div *ngIf="hasCurrentCategoryBlogs" class="category-content">
        <div class="blogs-grid">
          <div class="blog-card" 
               *ngFor="let blog of filteredBlogs" 
               (click)="onCardClick(blog._id!)">
            <div class="card-actions" *appShowForRoles="['admin']">
              <ion-button 
                fill="clear" 
                size="small" 
                (click)="editBlog(blog._id!, $event)"
                class="edit-btn">
                <ion-icon name="create-outline"></ion-icon>
              </ion-button>
              <ion-button 
                fill="clear" 
                size="small" 
                (click)="confirmDeleteBlog(blog._id!, $event)"
                class="delete-btn">
                <ion-icon name="trash-outline"></ion-icon>
              </ion-button>
            </div>
            <img [src]="blog.blogImgUrl" [alt]="blog.blogTitle">
            <div class="card-content">
              <h3>{{ blog.blogTitle }}</h3>
              <p class="author">By {{ blog.author }}</p>
              <p class="category-badge">{{ blog.category | titlecase }}</p>
              <div class="comments-count" *ngIf="blog.comments && blog.comments.length > 0">
                <ion-icon name="chatbubble-outline"></ion-icon>
                <span>{{ blog.comments.length }} comment{{ blog.comments.length !== 1 ? 's' : '' }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Show "No articles found" message when no blogs in current category -->
      <div *ngIf="!hasCurrentCategoryBlogs" class="no-articles-content">
        <div class="no-articles-card">
          <ion-icon name="language-outline" class="no-articles-icon"></ion-icon>
          <h2>No Articles Found</h2>
          <p>There are no articles in the "{{ selectedTopic | titlecase }}" category yet.</p>
          <p class="subtitle" *appShowForRoles="['admin']">Click "Add New Blog" to create the first article in this category!</p>
          <p class="subtitle" *ngIf="!(canShowAdminFeatures$ | async)">Please check back soon for new content!</p>
        </div>
      </div>
    </div>
  </div>
</ion-content>

<!-- Blog Form Modal -->
<app-blog-form
  [isOpen]="isFormOpen"
  [editingBlog]="editingBlog"
  (modalClosed)="closeBlogForm()"
  (blogSaved)="onBlogSaved($event)">
</app-blog-form>

<!-- Action Sheet for Blog Actions -->
<ion-action-sheet
  [isOpen]="isActionSheetOpen"
  header="Blog Actions"
  (didDismiss)="closeActionSheet()"
  [buttons]="actionSheetButtons">
</ion-action-sheet>