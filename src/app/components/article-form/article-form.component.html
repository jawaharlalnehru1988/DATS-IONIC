<ion-modal [isOpen]="isOpen" (didDismiss)="closeModal()">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>{{ isEditing ? 'Edit Article' : 'Add New Article' }}</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeModal()" fill="clear">
            <ion-icon name="close"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content class="article-form-content">
      <form [formGroup]="articleForm" (ngSubmit)="onSubmit()">
        <ion-grid>
          <ion-row>
            <ion-col size="12">
              <ion-card>
                <ion-card-header>
                  <ion-card-title>Article Information</ion-card-title>
                </ion-card-header>
                <ion-card-content>

                  <!-- Article Title -->
                  <ion-item>
                    <ion-label position="stacked">Article Title *</ion-label>
                    <ion-input
                      formControlName="articleTitle"
                      placeholder="Enter article title"
                      [class.ion-invalid]="articleForm.get('articleTitle')?.invalid && articleForm.get('articleTitle')?.touched">
                    </ion-input>
                  </ion-item>
                  @if (getErrorMessage('articleTitle')) {
                    <div class="error-message">
                      {{ getErrorMessage('articleTitle') }}
                    </div>
                  }

                  <!-- Description -->
                  <ion-item>
                    <ion-label position="stacked">Description *</ion-label>
                    <ion-textarea
                      formControlName="description"
                      placeholder="Enter article description"
                      rows="3"
                      [class.ion-invalid]="articleForm.get('description')?.invalid && articleForm.get('description')?.touched">
                    </ion-textarea>
                  </ion-item>
                  @if (getErrorMessage('description')) {
                    <div class="error-message">
                      {{ getErrorMessage('description') }}
                    </div>
                  }

                  <!-- Category -->
                  <ion-item>
                    <ion-label position="stacked">Category *</ion-label>
                    <ion-input
                      formControlName="categoryTitle"
                      placeholder="Enter category name"
                      list="categoryOptions"
                      [class.ion-invalid]="articleForm.get('categoryTitle')?.invalid && articleForm.get('categoryTitle')?.touched">
                    </ion-input>
                    <datalist id="categoryOptions">
                      @for (category of categoryTitles; track category) {
                        <option [value]="category">
                        </option>
                      }
                    </datalist>
                  </ion-item>
                  @if (getErrorMessage('categoryTitle')) {
                    <div class="error-message">
                      {{ getErrorMessage('categoryTitle') }}
                    </div>
                  }

                  <!-- Image URL -->
                  <ion-item>
                    <ion-label position="stacked">Image URL *</ion-label>
                    <ion-input
                      formControlName="imageUrl"
                      placeholder="https://example.com/image.jpg"
                      [class.ion-invalid]="articleForm.get('imageUrl')?.invalid && articleForm.get('imageUrl')?.touched">
                    </ion-input>
                  </ion-item>
                  @if (getErrorMessage('imageUrl')) {
                    <div class="error-message">
                      {{ getErrorMessage('imageUrl') }}
                    </div>
                  }

                  <!-- Image Alt Text -->
                  <ion-item>
                    <ion-label position="stacked">Image Alt Text *</ion-label>
                    <ion-input
                      formControlName="imageAlt"
                      placeholder="Describe the image for accessibility"
                      [class.ion-invalid]="articleForm.get('imageAlt')?.invalid && articleForm.get('imageAlt')?.touched">
                    </ion-input>
                  </ion-item>
                  @if (getErrorMessage('imageAlt')) {
                    <div class="error-message">
                      {{ getErrorMessage('imageAlt') }}
                    </div>
                  }

                </ion-card-content>
              </ion-card>
            </ion-col>
          </ion-row>

          <ion-row>
            <ion-col size="12">
              <ion-card>
                <ion-card-header>
                  <ion-card-title>Article Content</ion-card-title>
                </ion-card-header>
                <ion-card-content>

                  <!-- Rich Text Editor for Content -->
                  <div class="content-editor-container">
                    <ion-label>Content</ion-label>
                    <quill-editor
                      formControlName="content"
                      placeholder="Write your article content here..."
                      [style.height]="'300px'">
                    </quill-editor>
                  </div>

                </ion-card-content>
              </ion-card>
            </ion-col>
          </ion-row>

          <ion-row>
            <ion-col size="12">
              <div class="form-actions">
                <ion-button
                  expand="block"
                  type="submit"
                  [disabled]="articleForm.invalid"
                  color="primary">
                  <ion-icon name="save" slot="start"></ion-icon>
                  {{ isEditing ? 'Update Article' : 'Save Article' }}
                </ion-button>

                <ion-button
                  expand="block"
                  fill="outline"
                  color="medium"
                  (click)="closeModal()">
                  Cancel
                </ion-button>
              </div>
            </ion-col>
          </ion-row>

        </ion-grid>
      </form>
    </ion-content>
  </ng-template>
</ion-modal>

<!-- Toast for feedback -->
<ion-toast
  [isOpen]="isToastOpen"
  [message]="toastMessage"
  [color]="toastColor"
  duration="3000"
  (didDismiss)="isToastOpen = false">
</ion-toast>
