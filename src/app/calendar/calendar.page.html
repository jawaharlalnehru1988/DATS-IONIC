<app-reusable-header
  [title]="'Vaishnava Calendar'"
  [translucent]="true"
  [showMenuButton]="true">
</app-reusable-header>


<!-- <div class="calendar-section">
<ion-datetime minuteValues="0,15,30,45" dayValues="5,10,15,20,25,30"></ion-datetime>
</div> -->

<ion-content [fullscreen]="true">
  <div class="calendar-container">
    <!-- Calendar Navigation -->
    <div class="calendar-nav">
      <ion-button fill="clear" (click)="previousMonth()">
        <ion-icon name="chevron-back"></ion-icon>
      </ion-button>
      <h2>
        {{ monthNames[currentMonth] }} {{ currentYear }}
      </h2>
      <ion-button fill="clear" (click)="nextMonth()">
        <ion-icon name="chevron-forward"></ion-icon>
      </ion-button>
    </div>

    <!-- Calendar Header -->
    <div class="calendar-header">
      @for (day of dayNames; track day) {
        <div class="day-name">{{ day }}</div>
      }
    </div>

    <!-- Calendar Grid -->
    <div class="calendar-grid">
      @for (day of calendarDays; track day) {
        <div
          class="calendar-day"
          [class.other-month]="!day.isCurrentMonth"
          [class.today]="day.isToday"
          [class.selected]="isDateSelected(day)"
          [class.ekadasi]="day.hasEkadasi"
          [class.major-festival]="hasMajorFestival(day)"
          [class.festival]="hasOtherFestival(day)"
          (click)="onDateClick(day)">
          <span class="date-number">{{ day.date }}</span>
        </div>
      }
    </div>

    <!-- Festival/Special Day Details Section -->
    @if (selectedFestival) {
      <div class="festival-details">
        <div class="festival-header">
          <h3>{{ selectedFestival.festivalName }}</h3>
          <ion-button fill="clear" size="small" (click)="closeFestivalDetails()">
            <ion-icon name="close-outline"></ion-icon>
          </ion-button>
        </div>
        <div class="festival-content">
          @if (selectedFestival.startDate) {
            <div class="festival-info-item">
              <span class="info-label">Date:</span>
              <span class="info-value">{{ selectedFestival.startDate }}</span>
            </div>
          }
          @if (selectedFestival.importance) {
            <div class="festival-info-item">
              <span class="info-label">Festival-type:</span>
              <span class="info-value festival-type" [class]="selectedFestival.importance">{{ selectedFestival.importance }}</span>
            </div>
          }
          @if (selectedFestival.description) {
            <div class="festival-info-item">
              <span class="info-label">Description:</span>
              <span class="info-value festival-description">{{ selectedFestival.description }}</span>
            </div>
          }
      
          @if (selectedFestival.breakfastDate) {
            <div class="festival-info-item">
              <span class="info-label">Breakfast Date:</span>
              <span class="info-value">{{ selectedFestival.breakfastDate }}</span>
            </div>
          }
          @if (selectedFestival.breakfastStartTime && selectedFestival.breakfastEndTime) {
            <div class="festival-info-item">
              <span class="info-label">Breakfast Time:</span>
              <span class="info-value">{{ selectedFestival.breakfastStartTime }} - {{ selectedFestival.breakfastEndTime }}</span>
            </div>
          }
        </div>
      </div>
    }

    <!-- Vaishnava Information -->
    <div class="vaishnava-info">
      <div class="vaishnava-header">
        <h3>{{ selectedDate ? 'Selected Date: ' + getFormattedSelectedDate() : 'Vaishnava Calendar' }}</h3>
        <ion-button fill="clear" size="small">
          <ion-icon name="ellipsis-horizontal"></ion-icon>
        </ion-button>
      </div>

      <div class="vaishnava-grid">
        <div class="vaishnava-item">
          <span class="vaishnava-label">Year:</span>
          <span class="vaishnava-value">Gaurabda {{ vaishnavData.gaurabda }}</span>
        </div>
        <div class="vaishnava-item">
          <span class="vaishnava-label">Month:</span>
          <span class="vaishnava-value">{{ vaishnavData.masa }}</span>
        </div>
        <div class="vaishnava-item">
          <span class="vaishnava-label">Period:</span>
          <span class="vaishnava-value period-value">{{ vaishnavData.masaDateRange }}</span>
        </div>
        <div class="vaishnava-item">
          <span class="vaishnava-label">Tithi:</span>
          <span class="vaishnava-value">{{ vaishnavData.tithi }}</span>
        </div>
        <div class="vaishnava-item">
          <span class="vaishnava-label">Paksha:</span>
          <span class="vaishnava-value">{{ vaishnavData.paksa }} Paksa</span>
        </div>
        <div class="vaishnava-item">
          <span class="vaishnava-label">Nakshatra:</span>
          <span class="vaishnava-value">{{ vaishnavData.nakshatra }} ({{ vaishnavData.pada }})</span>
        </div>
        <div class="vaishnava-item">
          <span class="vaishnava-label">Tithi Left:</span>
          <span class="vaishnava-value">{{ vaishnavData.tithiPercentageLeft.toFixed(1) }}%</span>
        </div>
      </div>
    </div>

    <!-- Astronomical Information -->
    <div class="astro-info">
      <div class="astro-section">
        <!-- Sun Section -->
        <div class="sun-section">
          <div class="section-header">
            <ion-icon name="sunny-outline" class="sun-icon"></ion-icon>
            <h3>Solar Times</h3>
          </div>
          <div class="time-grid">
            <div class="time-item">
              <span class="time-label">Brahma muhurta:</span>
              <span class="time-value">{{ vaishnavData.brahmahmuhurta }}</span>
            </div>
            <div class="time-item">
              <span class="time-label">Sunrise:</span>
              <span class="time-value">{{ vaishnavData.sunrise }}</span>
            </div>
            <div class="time-item">
              <span class="time-label">Noon:</span>
              <span class="time-value">{{ vaishnavData.noon }}</span>
            </div>
            <div class="time-item">
              <span class="time-label">Sunset:</span>
              <span class="time-value">{{ vaishnavData.sunset }}</span>
            </div>
            <div class="time-item">
              <span class="time-label">Daylight:</span>
              <span class="time-value">{{ vaishnavData.daylight }}</span>
            </div>
          </div>
        </div>

        <!-- Moon Section -->
        <div class="moon-section">
          <div class="section-header">
            <ion-icon name="moon-outline" class="moon-icon"></ion-icon>
            <h3>Lunar Times</h3>
          </div>
          <div class="time-grid">
            <div class="time-item">
              <span class="time-label">Paksa:</span>
              <span class="time-value">{{ vaishnavData.paksa }}</span>
            </div>
            <div class="time-item">
              <span class="time-label">Moonrise:</span>
              <span class="time-value">{{ vaishnavData.moonrise }}</span>
            </div>
            <div class="time-item">
              <span class="time-label">Moonset:</span>
              <span class="time-value">{{ vaishnavData.moonset }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer Navigation Bar -->
  <div class="footer-nav">
    <div class="footer-nav-container">
      <ion-button
        fill="clear"
        class="footer-nav-btn back-btn"
        (click)="goBack()">
        <ion-icon name="arrow-back-outline" slot="icon-only"></ion-icon>
        <span class="btn-label">Back</span>
      </ion-button>

      <ion-button
        fill="clear"
        class="footer-nav-btn favorite-btn"
        [class.favorited]="isCurrentDateFavorited()"
        (click)="toggleFavorite()">
        <ion-icon
          [name]="isCurrentDateFavorited() ? 'heart' : 'heart-outline'"
          slot="icon-only">
        </ion-icon>
        <span class="btn-label">{{ isCurrentDateFavorited() ? 'Favorited' : 'Favorite' }}</span>
      </ion-button>

      <ion-button
        fill="clear"
        class="footer-nav-btn share-btn"
        (click)="shareEvent()">
        <ion-icon name="share-outline" slot="icon-only"></ion-icon>
        <span class="btn-label">Share</span>
      </ion-button>

      <ion-button
        fill="clear"
        class="footer-nav-btn add-festival-btn"
        (click)="openAddFestivalModal()">
        <ion-icon name="add-outline" slot="icon-only"></ion-icon>
        <span class="btn-label">Add Festival</span>
      </ion-button>
    </div>
  </div>

  <!-- Add Festival Modal -->
  <ion-modal 
    [isOpen]="isAddFestivalModalOpen" 
    (ionModalDidDismiss)="closeAddFestivalModal()"
    [canDismiss]="false"
    [backdropDismiss]="false"
    [keyboardClose]="false"
    class="festival-modal">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Add Festival</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeAddFestivalModal()">
              <ion-icon name="close"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      
      <ion-content class="ion-padding">
        <form [formGroup]="addFestivalForm" (ngSubmit)="onSubmitFestival($event)">
          
          <!-- Festival Name -->
          <ion-item [class.ion-invalid]="addFestivalForm.get('festivalName')?.invalid && addFestivalForm.get('festivalName')?.touched"
                    [class.ion-valid]="addFestivalForm.get('festivalName')?.valid && addFestivalForm.get('festivalName')?.touched"
                    [class.ion-touched]="addFestivalForm.get('festivalName')?.touched">
            <ion-label position="stacked">Festival Name *</ion-label>
            <ion-input 
              formControlName="festivalName" 
              placeholder="Enter festival name"
              type="text">
            </ion-input>
          </ion-item>
          
          <!-- Other Name -->
          <ion-item>
            <ion-label position="stacked">Other Name</ion-label>
            <ion-input 
              formControlName="otherName" 
              placeholder="Enter alternative name"
              type="text">
            </ion-input>
          </ion-item>
          
          <!-- Start Date -->
          <ion-item [class.ion-invalid]="addFestivalForm.get('startDate')?.invalid && addFestivalForm.get('startDate')?.touched"
                    [class.ion-valid]="addFestivalForm.get('startDate')?.valid && addFestivalForm.get('startDate')?.touched"
                    [class.ion-touched]="addFestivalForm.get('startDate')?.touched">
            <ion-label position="stacked">Start Date *</ion-label>
            <ion-input
              formControlName="startDate"
              type="date"
              placeholder="Select start date">
            </ion-input>
          </ion-item>
          
          <!-- Importance -->
          <ion-item [class.ion-invalid]="addFestivalForm.get('importance')?.invalid && addFestivalForm.get('importance')?.touched"
                    [class.ion-valid]="addFestivalForm.get('importance')?.valid && addFestivalForm.get('importance')?.touched"
                    [class.ion-touched]="addFestivalForm.get('importance')?.touched">
            <ion-label position="stacked">Importance *</ion-label>
            <ion-select formControlName="importance" placeholder="Select importance">
              <ion-select-option value="ekadashi">Ekadashi</ion-select-option>
              <ion-select-option value="major-festival">Major Festival</ion-select-option>
              <ion-select-option value="festival">Festival</ion-select-option>
            </ion-select>
          </ion-item>
          
          <!-- Breakfast Date -->
          <ion-item>
            <ion-label position="stacked">Breakfast Date</ion-label>
            <ion-input
              formControlName="breakfastDate"
              type="date"
              placeholder="Select breakfast date">
            </ion-input>
          </ion-item>

          <!-- Breakfast Until -->
          <ion-item>
            <ion-label position="stacked">Breakfast Until</ion-label>
            <ion-input
              formControlName="breakfastUntil"
              type="text"
              placeholder="Enter breakfast until">
            </ion-input>
          </ion-item>

          <!-- Breakfast Time -->
          <ion-item>
            <ion-label position="stacked">Breakfast Start Time</ion-label>
            <ion-input
              formControlName="breakfastStartTime"
              type="time"
              placeholder="Select breakfast start time">
            </ion-input>
          </ion-item>

          <!-- Breakfast End Time -->
          <ion-item>
            <ion-label position="stacked">Breakfast End Time</ion-label>
            <ion-input
              formControlName="breakfastEndTime"
              type="time"
              placeholder="Select breakfast end time">
            </ion-input>
          </ion-item>

          <!-- Description -->
          <div class="description-editor">
            <ion-label position="stacked">Description</ion-label>
            <quill-editor 
              formControlName="description"
              [modules]="{
                toolbar: [
                  ['bold', 'italic', 'underline'],
                  ['blockquote', 'code-block'],
                  [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                  ['link']
                ]
              }"
              placeholder="Enter festival description...">
            </quill-editor>
          </div>
          
          <!-- Form Actions -->
          <div class="form-actions">
            <ion-button 
              type="button" 
              fill="outline" 
              color="medium"
              (click)="closeAddFestivalModal()">
              Cancel
            </ion-button>
            <ion-button 
              type="submit" 
              [disabled]="!addFestivalForm.valid"
              color="primary">
              Add Festival
            </ion-button>
          </div>
          
        </form>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>

